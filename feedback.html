<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Feedback & Ideas</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    .wrap{max-width:1100px;margin:0 auto}

    /* ===== Make header/banner compact on this page only ===== */
    .site-header{min-height:auto !important}
    .site-header .container{
      padding-top:16px !important;
      padding-bottom:14px !important;
    }
    .site-header h1{font-size:28px !important; line-height:1.15}
    .site-header .subtitle{margin-top:6px !important; margin-bottom:0 !important; max-width:75ch}
    /* Reduce extra spacing that some pages get from global header-row styles */
    .header-row{padding:0 !important; margin:0 !important}

    .back-row{display:flex;align-items:center;margin:10px 0 0}
    .back-home{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border:1px solid var(--line);border-radius:999px;
      background:#fff;color:#0ea5e9;text-decoration:none;font-size:14px;
    }
    .back-home:hover{background:#f0f9ff}
    .back-home .chev{font-size:16px;line-height:1}

    /* ===== Embed card: minimal chrome ===== */
    .form-card{padding:0; overflow:hidden}
    .form-embed{
      width:100%;
      height:86vh;
      min-height:820px;
      border:0;
      display:block;
      background:#fff;
    }
    .helper{
      padding:10px 14px 12px;
      border-top:1px solid var(--line);
      background:#fff;
      color:#6b7280;
      font-size:13px;
    }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="container wrap">
      <div class="header-row">
        <div>
          <h1 style="margin:0">Feedback &amp; Ideas</h1>
          <p class="subtitle">Tell us how we can improve these tools.</p>
        </div>
      </div>

      <div class="back-row">
        <a class="back-home" href="./index.html" aria-label="Back to home">
          <span class="chev">←</span> Home
        </a>
      </div>
    </div>
  </header>

  <main class="container wrap">
    <section class="card form-card">
      <iframe
        id="msFormFrame"
        class="form-embed"
        title="Feedback & Ideas (Microsoft Form)"
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
        allow="fullscreen"
        src=""
      ></iframe>

      <div class="helper">
        If the embedded form doesn’t load properly in your browser, open it directly:
        <a id="directLink" href="#" target="_blank" rel="noopener">Microsoft Form link</a>.
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container wrap">
      <p>&copy; <span id="year"></span> UIUC • Prof. Tang • Interactive Tools</p>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // ====== Microsoft Forms base URL ======
    const BASE_FORM_URL =
      "https://forms.office.com/Pages/ResponsePage.aspx?id=b35GRCxGok6CP3gA3lQ04z3-gWze26lJrPNAvD0xDLlURUU5MVNHTkJWTVRSRUlMVTdRWFRIUElBSS4u";

    // Prefill field keys (from your prefilled link)
    const FIELD_COURSE = "rbf7c4dae51aa4203acd15fc86bf622e0";
    const FIELD_SIM    = "re20f1bdb957a4eb4986d7efe2381522d";

    function mapCourseToFormChoice(courseStr){
      const s = (courseStr || "").toLowerCase();
      if (s.includes("310") || s.includes("fluid")) return "Fluid Mechanics";
      if (s.includes("320") || s.includes("heat"))  return "Heat Transfer";
      if (s.includes("200") || s.includes("thermo"))return "Thermodynamics";
      if (courseStr === "Fluid Mechanics" || courseStr === "Heat Transfer" || courseStr === "Thermodynamics") {
        return courseStr;
      }
      return "";
    }

    function readContext(){
      const qs = new URLSearchParams(location.search);
      let course = qs.get("course") || "";
      let sim    = qs.get("sim") || "";

      if(!course || !sim){
        try{
          const ctx = JSON.parse(localStorage.getItem("fb_ctx") || "{}");
          course = course || (ctx.course || "");
          sim    = sim    || (ctx.sim || "");
        }catch{}
      }
      return { course: (course||"").trim(), sim: (sim||"").trim() };
    }

    function buildUrl({course, sim}){
      const u = new URL(BASE_FORM_URL);
      const courseChoice = mapCourseToFormChoice(course);

      if(courseChoice){
        u.searchParams.set(FIELD_COURSE, `"${courseChoice}"`);
      }
      if(sim){
        u.searchParams.set(FIELD_SIM, sim);
      }
      return u.toString();
    }

    (function init(){
      const { course, sim } = readContext();
      const finalUrl = buildUrl({course, sim});
      document.getElementById("msFormFrame").src = finalUrl;
      document.getElementById("directLink").href = finalUrl;
    })();
  </script>
</body>
</html>