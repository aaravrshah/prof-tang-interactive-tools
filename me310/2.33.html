<!-- /me310/2.33.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hydrostatic Pressure in a Liquid Undergoing Rigid-Body Rotation</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../styles.css" />
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <!-- MathJax -->
  <script>
    window.MathJax = { chtml:{scale:0.9}, options:{renderActions:{addMenu:[]}} };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    .site-header .container{padding-top:20px;padding-bottom:20px}
    .header-row{display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid #ffffff55;
         background:rgba(255,255,255,.12);color:#fff;text-decoration:none}
    .btn.primary{background:var(--accent);border-color:transparent}
    .btn.primary:hover{filter:brightness(1.06)}

    .back-row{display:flex;align-items:center;margin:12px 0 14px}
    .back-home{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border:1px solid var(--line);border-radius:999px;
      background:#fff;color:#0ea5e9;text-decoration:none;font-size:14px;
    }
    .back-home:hover{background:#f0f9ff}
    .back-home .chev{font-size:16px;line-height:1}

    /* Layout: equations + schematic */
    .top-grid{
      display:grid;
      gap:14px;
      margin-top:10px;
    }
    .left-col{display:flex;flex-direction:column;gap:12px}
    .side-col{display:flex;flex-direction:column;gap:12px}

    @media (min-width:1040px){
      .top-grid{
        grid-template-columns:minmax(0,2.1fr) minmax(280px,0.9fr);
        align-items:flex-start;
      }
      .side-col{
        position:sticky;
        top:96px;
        align-self:flex-start;
      }
    }

    .eq-card{max-height:none;overflow:visible}
    .eqwrap{margin-bottom:10px}
    .eqwrap p{margin:4px 0}
    .note{font-size:14px;color:#4b5563}

    .eq-heading-row{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:4px;
    }
    .eq-link{
      font-size:13px;
      color:#0ea5e9;
      text-decoration:none;
    }
    .eq-link:hover{text-decoration:underline}

    .schematic-card p{margin:0;font-size:14px;color:#4b5563}
    .schematic-img{
      display:block;
      max-width:100%;
      height:auto;
      margin:8px auto;
      border-radius:6px;
    }

    /* Inputs card */
    .inputs-card{margin-top:18px}
    .inputs-card h2{margin:4px 0 10px}

    .inputs-row{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      align-items:flex-start;
    }
    .input-box{
      flex:1 1 220px;
      min-width:200px;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:10px;
      background:#f9fafb;
    }
    .input-label{
      font-size:13px;
      color:#4b5563;
      margin-bottom:4px;
    }
    .slider-main{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .slider-main input[type="range"]{
      flex:1;
      width:100%;
    }
    .slider-main input[type="number"]{
      width:72px;
      padding:4px 6px;
      border-radius:8px;
      border:1px solid var(--line);
      font-size:13px;
    }

    .coord-inner{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:4px;
    }
    .coord-axis-label{
      font-size:12px;
      color:#4b5563;
      margin-bottom:2px;
    }
    .coord-axis input[type="range"]{width:100%}
    .coord-axis input[type="number"]{
      width:100%;
      padding:4px 6px;
      border-radius:8px;
      border:1px solid var(--line);
      font-size:13px;
      margin-top:4px;
    }

    /* Plots */
    .plots-grid{
      display:grid;gap:14px;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      margin-top:18px;
    }

    .viz{background:#fff;border:1px solid var(--line);border-radius:12px;padding:8px}
    #plot-iso,#plot-center,#plot-bottom{width:100%;height:auto;display:block}

    .legend-block{margin-top:10px}
    .legend-row{margin-bottom:6px}
    .legend-item{display:inline-flex;align-items:center;gap:6px;margin-right:12px;font-size:13px;color:#334155}
    .legend-item .sw{display:inline-block;width:14px;height:14px;border-radius:3px;border:1px solid #0002}
    .legend-block .dim-note{font-size:13px;color:#6b7280;margin:0;line-height:1.4}

    svg .axis text{font-size:14px}
    svg .axis-title{font-size:16px}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <div class="header-row">
        <div>
          <h1 style="margin:0">Hydrostatic Pressure in a Liquid Undergoing Rigid-Body Rotation</h1>
          <p class="subtitle">
            Explore how the pressure field \(p(r,z)\) varies in a rotating cylindrical container.
          </p>
        </div>
        <a class="btn primary feedback-link" href="../feedback.html" target="_blank" rel="noopener">Send feedback</a>
      </div>
    </div>
  </header>

  <main class="container">
    <nav class="back-row">
      <a href="../index.html" class="back-home" aria-label="Back to home">
        <span class="chev">←</span> Home
      </a>
    </nav>

    <!-- Top section: equations + schematic -->
    <section class="top-grid">
      <!-- Left: equations -->
      <div class="left-col">
        <!-- Hydrostatic eq + recall -->
        <div class="card eq-card">
          <h2 style="margin:4px 0 8px">Hydrostatic pressure equation</h2>
          <div class="eqwrap">
            <p class="note">
              For a liquid of density \( \rho \) in rigid-body rotation with angular velocity \( \omega \),
              the hydrostatic pressure distribution is
            </p>
            \[
              p(r,z) = \rho \frac{\omega^2 r^2}{2} - \rho g z + \text{constant}.
            \]
            <p class="note">
              The constant in this equation depends on the choice of \( z \)-origin and on the geometry and
              operating condition.
            </p>
          </div>

          <div class="eqwrap">
            <div class="eq-heading-row">
              <h3 style="margin:0">Recall: Free surface</h3>
              <a href="2.32.html" class="eq-link">See derivation (Eq.&nbsp;2.32)</a>
            </div>
            <p class="note">
              For a liquid in a vertical cylindrical container of radius \( R \) undergoing rigid-body rotation
              with angular velocity \( \omega \), the free surface profile (no spilling) is
            </p>
            \[
              z = h = \frac{\omega^2 r^2}{2g} + h_0,
              \quad \text{where} \quad
              h_0 = H - \frac{\omega^2 R^2}{4g}.
            \]
            <p class="note">That is,</p>
            \[
              z = h = \frac{\omega^2 r^2}{2g}
                    + H - \frac{\omega^2 R^2}{4g}.
            \]
            <p class="note">
              Here \( H \) is the liquid depth when the tank is at rest.
            </p>
          </div>
        </div>

        <!-- Determining constant -->
        <div class="card eq-card">
          <h2 style="margin:4px 0 8px">Determining the constant in the hydrostatic pressure equation</h2>
          <div class="eqwrap">
            <p class="note">
              At \( r = 0 \) and \( z = h_0 \), the free surface is exposed to atmosphere, so
              \( p = p_{\text{atm}} = 0 \) (gauge pressure). Thus
            </p>
            \[
              p(r,z) = \rho \frac{\omega^2 r^2}{2} - \rho g z + \text{constant}
              \quad\Rightarrow\quad
              \text{constant} = \rho g h_0 = \rho g\!\left(H - \frac{\omega^2 R^2}{4g}\right).
            \]
            <p class="note">Substituting back, the gauge pressure field is</p>
            \[
              \begin{aligned}
                p(r,z)
                  &= \rho \frac{\omega^2 r^2}{2} - \rho g z
                     + \rho g\!\left(H - \frac{\omega^2 R^2}{4g}\right) \\
                  &= \rho \frac{\omega^2}{4}\bigl(2r^2 - R^2\bigr) + \rho g(H - z).
              \end{aligned}
            \]
          </div>
        </div>

        <!-- Alternative form -->
        <div class="card eq-card">
          <h2 style="margin:4px 0 8px">Alternative form using local liquid depth</h2>
          <div class="eqwrap">
            <p class="note">
              The same expression can also be developed using \( p = \rho g\,\Delta h \), where
              \( \Delta h \) is the local liquid depth. For a point at \( (r,z) \),
            </p>
            \[
              \Delta h = h - z
                       = \frac{\omega^2 r^2}{2g} + h_0 - z.
            \]
            <p class="note">For the position at \( (r,z) \),</p>
            \[
              \begin{aligned}
                p(r,z)
                  &= \rho g\,\Delta h
                   = \rho g(h - z)
                   = \rho g\!\left(\frac{\omega^2 r^2}{2g} + h_0 - z\right) \\
                  &= \rho g\!\left(\frac{\omega^2 r^2}{2g} + H
                        - \frac{\omega^2 R^2}{4g} - z\right) \\
                  &= \rho \frac{\omega^2}{4}\bigl(2r^2 - R^2\bigr) + \rho g(H - z).
              \end{aligned}
            \]
          </div>
        </div>
      </div>

      <!-- Right: schematic -->
      <div class="side-col">
        <div class="card schematic-card">
          <h2 style="margin:4px 0 8px">Schematic</h2>
          <p>
            Vertical cylindrical container of radius \( R \) rotating at angular velocity \( \omega \).
            The bottom is at \( z = 0 \); the initial liquid depth at rest is \( H \).
          </p>
          <img src="../assets/thumbs/2.33.png"
               alt="Schematic of rotating cylindrical container"
               class="schematic-img">
          <p style="margin-top:6px">
            During rotation, the free surface \( z = h \) becomes parabolic. The depth at the center is
            \( h_0 = H - \dfrac{\omega^2 R^2}{4g} \).
          </p>
        </div>
      </div>
    </section>

    <!-- Inputs (full width) -->
    <section class="card inputs-card">
      <h2>Inputs</h2>
      <div class="inputs-row">
        <!-- omega -->
        <div class="input-box">
          <div class="input-label">Angular velocity \( \omega \) (rad/s)</div>
          <div class="slider-main">
            <input id="omegaSlider" type="range" min="0" max="10" step="0.1" value="7.0">
            <input id="omegaInput"  type="number" step="0.1">
          </div>
        </div>

        <!-- R -->
        <div class="input-box">
          <div class="input-label">Cylinder radius \( R \) (m)</div>
          <div class="slider-main">
            <input id="RSlider" type="range" min="0.10" max="0.50" step="0.01" value="0.40">
            <input id="RInput"  type="number" step="0.001">
          </div>
        </div>

        <!-- H -->
        <div class="input-box">
          <div class="input-label">
            Liquid depth at rest (i.e., \( \omega = 0 \)), \( H \) (m)
          </div>
          <div class="slider-main">
            <input id="HSlider" type="range" min="0.70" max="1.30" step="0.01" value="1.00">
            <input id="HInput"  type="number" step="0.001">
          </div>
        </div>

        <!-- coordinate for p -->
        <div class="input-box">
          <div class="input-label">Coordinate for \( p : (r,z) \) (m)</div>
          <div class="coord-inner">
            <div class="coord-axis">
              <div class="coord-axis-label">\( r \)</div>
              <input id="rSlider" type="range" min="0.000" max="0.40" step="0.005" value="0.300">
              <input id="rInput"  type="number" step="0.001">
            </div>
            <div class="coord-axis">
              <div class="coord-axis-label">\( z \)</div>
              <input id="zSlider" type="range" min="0.000" max="1.000" step="0.01" value="0.750">
              <input id="zInput"  type="number" step="0.001">
            </div>
          </div>
        </div>
      </div>

      <p class="note" style="margin-top:10px">
        Density is fixed at \( \rho = 998.2~\text{kg/m}^3 \) (water). The coordinate \( (r,z) \) defines
        one of the three constant-pressure lines shown in the \( r\text{–}z \) plane.
        You can also drag or click the blue point in the first plot to adjust \( r \) and \( z \).
      </p>
    </section>

    <!-- Three plots -->
    <section class="plots-grid">
      <!-- Plot 1: constant-pressure lines -->
      <div class="card">
        <h3 style="margin:4px 0 6px">Constant-Pressure Lines in the \( r\text{–}z \) Plane</h3>
        <div class="viz">
          <svg id="plot-iso" viewBox="0 0 360 460"
               aria-label="Constant-pressure lines in r-z plane"></svg>
        </div>
        <div id="legend-iso" class="legend-block"></div>
      </div>

      <!-- Plot 2: p vs z along centerline -->
      <div class="card">
        <h3 style="margin:4px 0 6px">Pressure vs Height at \( r = 0 \)</h3>
        <div class="viz">
          <svg id="plot-center" viewBox="0 0 360 460"
               aria-label="Pressure vs z at r = 0"></svg>
        </div>
        <div id="legend-center" class="legend-block"></div>
      </div>

      <!-- Plot 3: p vs r along bottom -->
      <div class="card">
        <h3 style="margin:4px 0 6px">Pressure vs Radius at \( z = 0 \)</h3>
        <div class="viz">
          <svg id="plot-bottom" viewBox="0 0 360 460"
               aria-label="Pressure vs r at z = 0"></svg>
        </div>
        <div id="legend-bottom" class="legend-block"></div>
      </div>
    </section>
  </main>

  <script>
    const g = 9.81;
    const rho = 998.2; // kg/m^3

    const state = {
      omega: 7.0,
      R: 0.40,
      H: 1.00,
      r: 0.30,
      z: 0.75
    };

    const OMIN = 0.0,  OMAX = 10.0;
    const RMIN = 0.10, RMAX = 0.50;
    const HMIN = 0.70, HMAX = 1.30;

    const colors = ['#2563eb','#f97316','#10b981'];

    function clamp(val, min, max){
      return Math.max(min, Math.min(max, val));
    }

    function freeSurfaceH0(omega, R, H){
      return H - (omega*omega*R*R)/(4*g);
    }
    function freeSurfaceZ(omega, R, H, r){
      const h0 = freeSurfaceH0(omega,R,H);
      return (omega*omega*r*r)/(2*g) + h0;
    }

    // Gauge pressure field p(r,z) in Pa
    function pGauge(omega, R, H, r, z){
      return rho * ( (omega*omega/4)*(2*r*r - R*R) + g*(H - z) );
    }

    // ----- Plot helpers -----
    function initPlot(id, xLabel, yLabel){
      const svg = d3.select('#'+id);
      const W = 360, Hh = 460;
      const margin = {top:20,right:16,bottom:60,left:64};
      const iw = W - margin.left - margin.right;
      const ih = Hh - margin.top - margin.bottom;

      svg.attr('viewBox',`0 0 ${W} ${Hh}`);

      const gMain = svg.append('g').attr('transform',`translate(${margin.left},${margin.top})`);
      const axesG = gMain.append('g').attr('class','axes');
      const curvesG = gMain.append('g').attr('class','curves');

      const xAxisG = axesG.append('g')
        .attr('class','axis axis--x')
        .attr('transform',`translate(0,${ih})`);
      const yAxisG = axesG.append('g')
        .attr('class','axis axis--y');

      axesG.append('text')
        .attr('class','axis-title')
        .attr('x', iw/2)
        .attr('y', ih + 44)
        .attr('text-anchor','middle')
        .text(xLabel);

      axesG.append('text')
        .attr('class','axis-title')
        .attr('transform',`translate(-50,${ih/2}) rotate(-90)`)
        .attr('text-anchor','middle')
        .text(yLabel);

      const xScale = d3.scaleLinear().range([0,iw]);
      const yScale = d3.scaleLinear().range([ih,0]);

      const line = d3.line()
        .x(d=>xScale(d.x))
        .y(d=>yScale(d.y));

      return {svg,gMain,axesG,curvesG,xAxisG,yAxisG,xScale,yScale,line,iw,ih,margin};
    }

    const isoPlot    = initPlot('plot-iso','r (m)','z (m)');
    const centerPlot = initPlot('plot-center','z (m)','p (kPa)');
    const bottomPlot = initPlot('plot-bottom','r (m)','p (kPa)');

    // Add hitbox for click/drag in iso plot
    const isoHitbox = isoPlot.gMain.append('rect')
      .attr('x',0).attr('y',0)
      .attr('width',isoPlot.iw)
      .attr('height',isoPlot.ih)
      .style('fill','transparent')
      .style('pointer-events','all');

    isoPlot.pointSel = isoPlot.curvesG.append('circle')
      .attr('r',4)
      .attr('fill',colors[0])
      .attr('stroke','#fff')
      .attr('stroke-width',1.4)
      .style('cursor','pointer');

    function setPointFromCoords(px,py){
      // Convert pixel coords -> data coords, then clamp to liquid region
      let r = isoPlot.xScale.invert(px);
      let z = isoPlot.yScale.invert(py);

      r = clamp(r,0,state.R);
      const zMax = freeSurfaceZ(state.omega,state.R,state.H,r);
      z = clamp(z,0,zMax);

      state.r = r;
      state.z = z;
      renderAll();
    }

    const dragBehavior = d3.drag()
      .on('start drag', (event)=>{
        const pt = d3.pointer(event, isoPlot.gMain.node());
        setPointFromCoords(pt[0], pt[1]);
      });

    isoHitbox.call(dragBehavior);
    isoPlot.pointSel.call(dragBehavior);

    isoHitbox.on('click',event=>{
      const pt = d3.pointer(event, isoPlot.gMain.node());
      setPointFromCoords(pt[0], pt[1]);
    });

    function updateIso(){
      const {omega,R,H,r,z} = state;
      const h0 = freeSurfaceH0(omega,R,H);

      const p1 = pGauge(omega,R,H,r,z);
      const p2 = pGauge(omega,R,H,0,h0);          // = 0 (gauge)
      const p3 = pGauge(omega,R,H,0,0.5*h0);

      const pConsts = [p1,p2,p3];

      const curves = pConsts.map((pConst,idx)=>{
        const pts = [];
        const N = 200;
        for(let i=0;i<=N;i++){
          const rr = R * i/N;
          const zSurf = freeSurfaceZ(omega,R,H,rr);
          // From p(r,z) = pConst solve for z in liquid:
          const zVal = H + (omega*omega/(4*g))*(2*rr*rr - R*R) - pConst/(rho*g);
          if(zVal >= 0 && zVal <= zSurf + 1e-6){
            pts.push({x:rr,y:zVal});
          }
        }
        return {key:'c'+idx, pts};
      });

      // Determine vertical extent of liquid actually plotted
      let zMax = 0;
      curves.forEach(c=>{
        c.pts.forEach(p=>{
          if(p.y > zMax) zMax = p.y;
        });
      });
      if (zMax <= 0) zMax = state.H;

      // Step y-axis limits: 2, 5, or 20 m
      let yCap;
      if (zMax <= 2) yCap = 2;
      else if (zMax <= 5) yCap = 5;
      else yCap = 20;

      isoPlot.xScale.domain([0,state.R]);
      isoPlot.yScale.domain([0,yCap]);

      const xAxis = d3.axisBottom(isoPlot.xScale).ticks(5);
      const yAxis = d3.axisLeft(isoPlot.yScale).ticks(5);

      isoPlot.xAxisG.call(xAxis);
      isoPlot.yAxisG.call(yAxis);

      const paths = isoPlot.curvesG.selectAll('path.curve')
        .data(curves, d=>d.key);

      paths.enter()
        .append('path')
        .attr('class','curve')
        .attr('fill','none')
        .attr('stroke-width',2.2)
        .merge(paths)
        .attr('stroke',(d,i)=>colors[i])
        .attr('d',d=>isoPlot.line(d.pts));

      paths.exit().remove();

      // Update draggable point position
      isoPlot.pointSel
        .attr('cx', isoPlot.xScale(state.r))
        .attr('cy', isoPlot.yScale(state.z));

      // Legend
      const legend = document.getElementById('legend-iso');
      legend.innerHTML =
        '<div class="legend-row">' +
        `<span class="legend-item"><span class="sw" style="background:${colors[0]}"></span><span>\\( p_1 = p(r,z) \\)</span></span>` +
        `<span class="legend-item"><span class="sw" style="background:${colors[1]}"></span><span>\\( p_2 = p(0,h_0) \\) (free surface)</span></span>` +
        `<span class="legend-item"><span class="sw" style="background:${colors[2]}"></span><span>\\( p_3 = p(0, \\tfrac{1}{2}h_0) \\)</span></span>` +
        '</div>' +
        `<p class="dim-note">
          Three constant-pressure lines in the \( r\\text{–}z \) plane.
          \(p_2\) lies on the free surface where \(p(0,h_0) = 0\).
          \(p_1\) uses the input point \((r,z)\), and \(p_3\) uses the midpoint
          \((0, \\tfrac{1}{2}h_0)\) on the axis.
        </p>`;

      if(window.MathJax && window.MathJax.typesetPromise){
        MathJax.typesetPromise([legend]);
      }
    }

    function updateCenter(){
      const {omega,R,H} = state;
      const h0 = freeSurfaceH0(omega,R,H);
      const N = 120;
      const pts = [];
      let pMax = 0;

      for(let i=0;i<=N;i++){
        const z = h0 * i/N;
        const pRaw = pGauge(omega,R,H,0,z)/1000; // kPa
        const p = Math.max(0,pRaw);
        pts.push({x:z,y:p});
        if(p > pMax) pMax = p;
      }

      const pad = 0.05*(pMax || 1);
      centerPlot.xScale.domain([0,h0]);
      centerPlot.yScale.domain([0,pMax+pad]);

      const xAxis = d3.axisBottom(centerPlot.xScale).ticks(5);
      const yAxis = d3.axisLeft(centerPlot.yScale).ticks(5);

      centerPlot.xAxisG.call(xAxis);
      centerPlot.yAxisG.call(yAxis);

      const path = centerPlot.curvesG.selectAll('path.curve')
        .data([pts]);

      path.enter()
        .append('path')
        .attr('class','curve')
        .attr('fill','none')
        .attr('stroke-width',2.2)
        .merge(path)
        .attr('stroke',colors[0])
        .attr('d',centerPlot.line);

      path.exit().remove();

      const legend = document.getElementById('legend-center');
      legend.innerHTML =
        `<p class="dim-note">
          Gauge pressure \(p(r,z)\) along the centerline \(r = 0\),
          from the bottom \(z = 0\) up to the free surface at \(z = h_0\),
          where \(p = 0\).
        </p>`;

      if(window.MathJax && window.MathJax.typesetPromise){
        MathJax.typesetPromise([legend]);
      }
    }

    function updateBottom(){
      const {omega,R,H} = state;
      const N = 120;
      const pts = [];
      let pMin = Infinity, pMax = -Infinity;

      for(let i=0;i<=N;i++){
        const r = R * i/N;
        const p = pGauge(omega,R,H,r,0)/1000; // kPa
        pts.push({x:r,y:p});
        if(p < pMin) pMin = p;
        if(p > pMax) pMax = p;
      }

      const span = (pMax - pMin) || 1;
      const pad = 0.05*span;
      bottomPlot.xScale.domain([0,R]);
      bottomPlot.yScale.domain([pMin-pad, pMax+pad]);

      const xAxis = d3.axisBottom(bottomPlot.xScale).ticks(5);
      const yAxis = d3.axisLeft(bottomPlot.yScale).ticks(5);

      bottomPlot.xAxisG.call(xAxis);
      bottomPlot.yAxisG.call(yAxis);

      const path = bottomPlot.curvesG.selectAll('path.curve')
        .data([pts]);

      path.enter()
        .append('path')
        .attr('class','curve')
        .attr('fill','none')
        .attr('stroke-width',2.2)
        .merge(path)
        .attr('stroke',colors[1])
        .attr('d',bottomPlot.line);

      path.exit().remove();

      const legend = document.getElementById('legend-bottom');
      legend.innerHTML =
        `<p class="dim-note">
          Gauge pressure \(p(r,z)\) along the bottom \(z = 0\) of the container,
          from the rotation axis \(r = 0\) to the wall at \(r = R\).
        </p>`;

      if(window.MathJax && window.MathJax.typesetPromise){
        MathJax.typesetPromise([legend]);
      }
    }

    function applyBounds(){
      state.omega = clamp(state.omega, OMIN, OMAX);
      state.R     = clamp(state.R,     RMIN, RMAX);
      state.H     = clamp(state.H,     HMIN, HMAX);

      state.r     = clamp(state.r, 0, state.R);
      const zMax  = freeSurfaceZ(state.omega,state.R,state.H,state.r);
      state.z     = clamp(state.z, 0, zMax);
    }

    function syncInputs(){
      const omegaSlider = document.getElementById('omegaSlider');
      const omegaInput  = document.getElementById('omegaInput');
      const RSlider     = document.getElementById('RSlider');
      const RInput      = document.getElementById('RInput');
      const HSlider     = document.getElementById('HSlider');
      const HInput      = document.getElementById('HInput');
      const rSlider     = document.getElementById('rSlider');
      const rInput      = document.getElementById('rInput');
      const zSlider     = document.getElementById('zSlider');
      const zInput      = document.getElementById('zInput');

      omegaSlider.value = state.omega;
      omegaInput.value  = state.omega.toFixed(2);

      RSlider.value = state.R;
      RInput.value  = state.R.toFixed(3);

      HSlider.value = state.H;
      HInput.value  = state.H.toFixed(3);

      rSlider.max = state.R.toFixed(3);
      rSlider.value = state.r;
      rInput.value  = state.r.toFixed(3);

      const zMax = freeSurfaceZ(state.omega,state.R,state.H,state.r);
      zSlider.max = zMax.toFixed(3);
      zSlider.value = state.z;
      zInput.value  = state.z.toFixed(3);
    }

    function renderAll(){
      applyBounds();
      syncInputs();
      updateIso();
      updateCenter();
      updateBottom();
    }

    function setupInputs(){
      const omegaSlider = document.getElementById('omegaSlider');
      const omegaInput  = document.getElementById('omegaInput');
      const RSlider     = document.getElementById('RSlider');
      const RInput      = document.getElementById('RInput');
      const HSlider     = document.getElementById('HSlider');
      const HInput      = document.getElementById('HInput');
      const rSlider     = document.getElementById('rSlider');
      const rInput      = document.getElementById('rInput');
      const zSlider     = document.getElementById('zSlider');
      const zInput      = document.getElementById('zInput');

      omegaSlider.addEventListener('input', e=>{
        state.omega = parseFloat(e.target.value) || 0;
        renderAll();
      });
      omegaInput.addEventListener('input', e=>{
        state.omega = parseFloat(e.target.value) || state.omega;
        renderAll();
      });

      RSlider.addEventListener('input', e=>{
        state.R = parseFloat(e.target.value) || state.R;
        renderAll();
      });
      RInput.addEventListener('input', e=>{
        state.R = parseFloat(e.target.value) || state.R;
        renderAll();
      });

      HSlider.addEventListener('input', e=>{
        state.H = parseFloat(e.target.value) || state.H;
        renderAll();
      });
      HInput.addEventListener('input', e=>{
        state.H = parseFloat(e.target.value) || state.H;
        renderAll();
      });

      rSlider.addEventListener('input', e=>{
        state.r = parseFloat(e.target.value) || state.r;
        renderAll();
      });
      rInput.addEventListener('input', e=>{
        state.r = parseFloat(e.target.value) || state.r;
        renderAll();
      });

      zSlider.addEventListener('input', e=>{
        state.z = parseFloat(e.target.value) || state.z;
        renderAll();
      });
      zInput.addEventListener('input', e=>{
        state.z = parseFloat(e.target.value) || state.z;
        renderAll();
      });
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      setupInputs();
      renderAll();
      if(window.MathJax && MathJax.typesetPromise){
        MathJax.typesetPromise();
      }
    });
  </script>

  <!-- Feedback context -->
  <script>
    const FEEDBACK = {
      course: 'ME 310',
      sim: 'Eq 2.33 Hydrostatic Pressure in a Liquid Undergoing Rigid-Body Rotation'
    };
    document.addEventListener('DOMContentLoaded', () => {
      const url = new URL('../feedback.html', location.href);
      if (FEEDBACK.course) url.searchParams.set('course', FEEDBACK.course);
      if (FEEDBACK.sim)    url.searchParams.set('sim',    FEEDBACK.sim);
      document.querySelectorAll('a.feedback-link').forEach(a => {
        a.href = url.toString();
        try { localStorage.setItem('fb_ctx', JSON.stringify(FEEDBACK)); } catch {}
      });
    });
  </script>
</body>
</html>
