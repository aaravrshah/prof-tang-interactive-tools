<!-- /me310/1.22.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Eq. 1.22: capillary rise in a tube</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../styles.css" />

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>window.MathJax={chtml:{scale:0.9},options:{renderActions:{addMenu:[]}}}</script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    .site-header .container{padding-top:20px;padding-bottom:20px}
    .header-row{display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid #ffffff55;
         background:rgba(255,255,255,.12);color:#fff;text-decoration:none}
    .btn.primary{background:var(--accent);border-color:transparent}

    .top-grid{display:grid;gap:12px}
    @media (min-width:1024px){ .top-grid{grid-template-columns:1.5fr .9fr} }

    .ctl{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px}
    .eqwrap{padding:12px;border:1px dashed var(--line);border-radius:12px;background:#fcfcff}
    .eqbig{font-size:1.02em}
    .title-xl{font-size:18px;line-height:1.25;color:#111}

    .eq-schem{display:grid;gap:12px}
    @media (min-width:900px){ .eq-schem{grid-template-columns:1.2fr .8fr} }

    .schem{
      min-height:240px;border:2px dashed var(--line);border-radius:12px;background:#fafcff;
      display:flex;align-items:center;justify-content:center;color:#64748b
    }
    .schem small{display:block;margin-top:6px;color:#94a3b8}

    .controls{display:grid;gap:12px}
    .rowflex{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .inline{display:flex;align-items:center;gap:8px}
    .num-sm{width:170px}
    .controls input.num-sm[type="number"]{width:170px !important}
    .hint{font-size:12px;color:#6b7280;margin-top:4px}

    input:disabled{background:#f3f4f6!important;color:#6b7280!important;cursor:not-allowed;opacity:1}

    .kpi{display:grid;gap:10px;margin-top:10px;grid-template-columns:repeat(2,minmax(120px,1fr))}
    .kpi .lab{font-size:12px;color:#6b7280}
    .kpi .val{font-size:16px;font-weight:600;color:#334155}

    .viz{background:#fff;border:1px solid var(--line);border-radius:12px;padding:8px}
    .axis text{font-size:14px}
    .axis-title{font-size:15px}
    .curve{stroke:#111;fill:none;stroke-width:2}
    .zeroline{stroke:#000;stroke-opacity:.35;stroke-dasharray:6 6}
    .dragpt{fill:#ef4444;stroke:#111;stroke-width:1.2}
    .hit{fill:transparent;cursor:ew-resize}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div class="header-row">
        <h1 style="margin:0">Eq. 1.22: capillary rise in a tube</h1>
        <a class="btn primary feedback-link" href="../feedback.html" target="_blank" rel="noopener">Send feedback</a>
      </div>
    </div>
  </header>

  <main class="container">
    <nav class="back-row">
      <a href="../index.html" class="back-home" aria-label="Back to home"><span class="chev">←</span> Home</a>
    </nav>

    <section class="top-grid">
      <div class="ctl">
        <div class="eq-schem">
          <div class="eqwrap">
            <div class="note title-xl" style="margin-bottom:10px"><b>Capillary rise in a circular tube (Jurin’s law)</b></div>
            <div class="eqbig">
              \( \displaystyle h = \frac{2\sigma \cos\theta}{\rho g r}
                 \;=\; \frac{4\sigma \cos\theta}{\rho g D} \)
            </div>
            <div class="note" style="margin-top:12px"><b>Symbols</b>
              <ul style="margin:8px 0 0 20px">
                <li><b>\(h\)</b> — capillary rise (+) or depression (−) (m)</li>
                <li><b>\(\sigma\)</b> — surface tension (N·m\(^{-1}\))</li>
                <li><b>\(\theta\)</b> — static contact angle (°), measured in the liquid</li>
                <li><b>\(\rho\)</b> — liquid density (kg·m\(^{-3}\))</li>
                <li><b>\(r\)</b>, <b>\(D\)</b> — tube radius, inner diameter (m), with \(D=2r\)</li>
              </ul>
            </div>
          </div>

          <div class="schem">
            <div style="text-align:center">
              <div>📐 Schematic placeholder</div>
              <small>(capillary tube, meniscus, contact angle θ, rise h)</small>
            </div>
          </div>
        </div>

        <div class="viz" style="margin-top:12px">
          <svg id="plot" viewBox="0 0 760 320" aria-label="h vs D plot"></svg>
        </div>
      </div>

      <div class="ctl">
        <div class="controls">
          <div>
            <label>Fluid preset (σ, ρ at 20 °C)</label>
            <select id="fluid">
              <option value="custom">Custom…</option>
              <option value="water" selected>Water — σ = 0.0728 N/m, ρ = 998 kg/m³</option>
              <option value="ethanol">Ethanol — σ = 0.0223 N/m, ρ = 789 kg/m³</option>
              <option value="mercury">Mercury — σ = 0.4850 N/m, ρ = 13534 kg/m³</option>
            </select>
            <div class="hint">Choose a preset or pick <b>Custom…</b> to edit σ and ρ.</div>
          </div>

          <div class="rowflex">
            <div>
              <label>Surface tension, σ (N/m)</label>
              <input id="sigma" class="num-sm" type="number" min="0" step="0.0001" value="0.0728" />
            </div>
            <div>
              <label>Density, ρ (kg/m³)</label>
              <input id="rho" class="num-sm" type="number" min="1" step="1" value="998" />
            </div>
          </div>

          <div class="rowflex">
            <div style="flex:1 1 auto">
              <label>Tube inner diameter, D</label>
              <div class="inline">
                <input id="D" class="num-sm" type="number" step="0.001" value="1.00" />
                <select id="Dunit" aria-label="diameter unit">
                  <option value="m">m</option>
                  <option value="mm" selected>mm</option>
                  <option value="um">μm</option>
                </select>
              </div>
              <!-- NEW: D slider matches plot domain (in mm) -->
              <input id="D_s" type="range" min="0.1" max="10" step="0.01" value="1.00" style="width:260px;margin-top:8px">
              <div class="hint">Plot range: 0.10–10.00 mm. Use the slider or drag the red dot.</div>
            </div>

            <div>
              <label>Contact angle, θ (°)</label>
              <input id="theta" class="num-sm" type="number" min="0" max="180" step="1" value="0" />
            </div>
          </div>

          <div>
            <label>Current values</label>
            <div class="kpi">
              <div><div class="lab">h (m)</div><div id="kpi_h_m" class="val">—</div></div>
              <div><div class="lab">h (mm)</div><div id="kpi_h_mm" class="val">—</div></div>
              <div><div class="lab">Sign</div><div id="kpi_sign" class="val">—</div></div>
            </div>
          </div>

          <p class="note" style="margin:0">
            \(g = 9.81\ \mathrm{m/s^2}\). Explore diameters from <b>0.1–10 mm</b> and contact angles from <b>0–150°</b> to see how \(h\) responds. Positive \(h\) (wetting) occurs when \(\cos\theta>0\); negative \(h\) (depression) when \(\cos\theta<0\).
          </p>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:12px">
      <div class="note">
        This tool uses \( h = \tfrac{4\sigma\cos\theta}{\rho g D} \) for circular tubes with \( D = 2r \).
        Try realistic ranges (e.g., water at 20 °C, \(D\) between 0.1–10 mm) and vary \(\theta\) to see the sign and magnitude of the rise.
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <a href="../index.html" class="back-home"><span class="chev">←</span> Home</a>
    </div>
  </footer>

  <script>
    /* ---------- helpers & constants ---------- */
    const $ = id => document.getElementById(id);
    const toMeters = (val, unit) => {
      const v = parseFloat(val);
      if (!Number.isFinite(v) || v <= 0) return NaN;
      if (unit === 'm')  return v;
      if (unit === 'mm') return v * 1e-3;
      if (unit === 'um') return v * 1e-6;
      return v;
    };
    const PRESETS = {
      water:   { sigma: 0.0728, rho: 998 },
      ethanol: { sigma: 0.0223, rho: 789 },
      mercury: { sigma: 0.4850, rho: 13534 }
    };
    const gval = 9.81, cosd = d => Math.cos(d*Math.PI/180);
    const clamp = (v, lo, hi) => Math.min(hi, Math.max(lo, v));

    // Fixed plot + input bounds (mm)
    const D_MIN_MM = 0.1, D_MAX_MM = 10.0;
    const X_MIN = D_MIN_MM, X_MAX = D_MAX_MM;
    const Y_MAX = 200; // |h| in mm

    function setDNumberBounds(){
      const u = $('Dunit').value;
      let min,max,step;
      if (u==='mm'){ min=D_MIN_MM; max=D_MAX_MM; step=0.01; }
      else if (u==='m'){  min=D_MIN_MM*1e-3; max=D_MAX_MM*1e-3; step=0.0001; }
      else { /* um */   min=D_MIN_MM*1000; max=D_MAX_MM*1000; step=1; }
      $('D').min=min; $('D').max=max; $('D').step=step;
    }

    /* ---------- compute + KPIs ---------- */
    function computeH(sigma, rho, D_m, theta_deg){
      return (4 * sigma * cosd(theta_deg)) / (rho * gval * D_m);
    }
    function updateKPIs(h_m){
      $('kpi_h_m').textContent  = Number.isFinite(h_m) ? h_m.toExponential(3) : '—';
      $('kpi_h_mm').textContent = Number.isFinite(h_m) ? (h_m*1000).toFixed(3) : '—';
      $('kpi_sign').textContent = Number.isFinite(h_m)
        ? (h_m > 0 ? 'Rise' : (h_m < 0 ? 'Depression' : 'Zero')) : '—';
    }

    /* ---------- plot (fixed axes + dragger) ---------- */
    function drawPlotFrame(){
      const svg = d3.select('#plot'); svg.selectAll('*').remove();
      const W = 760, H = 320, m = {l:64,r:16,t:14,b:54};
      const iw = W - m.l - m.r, ih = H - m.t - m.b;

      const x = d3.scaleLinear().domain([X_MIN, X_MAX]).range([m.l, m.l+iw]);
      const y = d3.scaleLinear().domain([-Y_MAX, Y_MAX]).range([m.t+ih, m.t]);

      svg.append('g').attr('class','axis').attr('transform',`translate(0,${m.t+ih})`)
        .call(d3.axisBottom(x).ticks(10));
      svg.append('g').attr('class','axis').attr('transform',`translate(${m.l},0)`)
        .call(d3.axisLeft(y).ticks(8));
      svg.append('text').attr('class','axis-title').attr('x',W/2).attr('y',H-10)
        .attr('text-anchor','middle').text('D (mm)');
      svg.append('text').attr('class','axis-title').attr('x',-(H/2)).attr('y',18)
        .attr('text-anchor','middle').attr('transform','rotate(-90)').text('h (mm)');

      svg.append('line').attr('class','zeroline')
        .attr('x1', x(X_MIN)).attr('x2', x(X_MAX)).attr('y1', y(0)).attr('y2', y(0));

      return {svg, x, y, m, W, H};
    }

    function drawCurveAndDragger(scales, sigma, rho, thetaDeg, Dm_clamped){
      const {svg, x, y} = scales;

      const Dmm = d3.range(X_MIN, X_MAX + 0.0001, 0.02);
      const Hmm = Dmm.map(Dv => (4*sigma*cosd(thetaDeg))/(rho*gval*(Dv*1e-3))*1000);
      svg.append('path').attr('class','curve')
        .attr('d', d3.line().curve(d3.curveMonotoneX)(Dmm.map((d,i)=>[x(d), y(Hmm[i])])));

      const D_now_mm = Dm_clamped*1000;
      const h_now_mm = (4*sigma*cosd(thetaDeg))/(rho*gval*Dm_clamped)*1000;

      const dragpt = svg.append('circle').attr('class','dragpt')
        .attr('r',6).attr('cx', x(D_now_mm)).attr('cy', y(h_now_mm));

      const hit = svg.append('rect').attr('class','hit')
        .attr('x', x(X_MIN)).attr('y', y(Y_MAX))
        .attr('width', x(X_MAX)-x(X_MIN)).attr('height', y(-Y_MAX)-y(Y_MAX));

      const drag = d3.drag()
        .on('start drag', (event)=>{
          const xm = Math.max(x(X_MIN), Math.min(x(X_MAX), event.x));
          let Dmm_new = x.invert(xm);
          Dmm_new = Math.round(Dmm_new*100)/100; // snap 0.01 mm
          const h_mm_new = (4*sigma*cosd(thetaDeg))/(rho*gval*(Dmm_new*1e-3))*1000;

          dragpt.attr('cx', x(Dmm_new)).attr('cy', y(Math.max(-Y_MAX, Math.min(Y_MAX, h_mm_new))));

          // sync number + slider
          const unit = $('Dunit').value;
          if (unit === 'mm') $('D').value = Dmm_new.toFixed(2);
          else if (unit === 'm') $('D').value = (Dmm_new*1e-3).toFixed(4);
          else $('D').value = (Dmm_new*1000).toFixed(0);
          $('D_s').value = Dmm_new.toFixed(2);

          updateKPIs(h_mm_new/1000);
        })
        .on('end', ()=> compute());

      hit.call(drag);
    }

    /* ---------- UI wiring ---------- */
    function setPresetMode(){
      const isCustom = $('fluid').value === 'custom';
      $('sigma').disabled = !isCustom;
      $('rho').disabled   = !isCustom;
      compute();
    }

    function compute(){
      // Lock σ,ρ if preset
      const preset = $('fluid').value;
      if (preset in PRESETS){
        $('sigma').value = PRESETS[preset].sigma.toString();
        $('rho').value   = PRESETS[preset].rho.toString();
      }

      const sigma = Math.max(0, parseFloat($('sigma').value));
      const rho   = Math.max(1, parseFloat($('rho').value));
      const unit  = $('Dunit').value;

      // Apply unit-aware bounds to the number input
      setDNumberBounds();

      // Read D, clamp to plot domain (in mm), reflect back to inputs
      let Dm = toMeters($('D').value, unit);
      let Dmm = Dm*1000;
      if (!Number.isFinite(Dmm)) Dmm = 1.0;
      const DmmC = clamp(Dmm, D_MIN_MM, D_MAX_MM);

      if (Dmm !== DmmC){
        if (unit==='mm') $('D').value = DmmC.toFixed(2);
        else if (unit==='m') $('D').value = (DmmC*1e-3).toFixed(4);
        else $('D').value = (DmmC*1000).toFixed(0);
      }
      $('D_s').value = DmmC.toFixed(2);

      const DmC = DmmC*1e-3;

      const th = parseFloat($('theta').value);
      const h  = computeH(sigma, rho, DmC, th);
      updateKPIs(h);

      const scales = drawPlotFrame();
      drawCurveAndDragger(scales, sigma, rho, th, DmC);
    }

    function init(){
      $('fluid').addEventListener('change', setPresetMode);

      // number input, unit select, theta, sigma, rho
      ['sigma','rho','D','theta'].forEach(id => $(id).addEventListener('input', compute));
      $('Dunit').addEventListener('change', ()=>{ setDNumberBounds(); compute(); });

      // slider -> number (unit aware)
      $('D_s').addEventListener('input', e=>{
        const Dmm = parseFloat(e.target.value);
        const unit = $('Dunit').value;
        if (unit==='mm') $('D').value = Dmm.toFixed(2);
        else if (unit==='m') $('D').value = (Dmm*1e-3).toFixed(4);
        else $('D').value = (Dmm*1000).toFixed(0);
        compute();
      });

      // initial state
      setDNumberBounds();
      setPresetMode(); // calls compute()
      window.addEventListener('resize', compute);
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>

  <script>
    const FEEDBACK = { course: 'ME 310', sim: 'Eq. 1.22: capillary rise in a tube' };
    document.addEventListener('DOMContentLoaded', () => {
      const url = new URL('../feedback.html', location.href);
      if (FEEDBACK.course) url.searchParams.set('course', FEEDBACK.course);
      if (FEEDBACK.sim)    url.searchParams.set('sim',    FEEDBACK.sim);
      document.querySelectorAll('a.feedback-link').forEach(a => {
        a.href = url.toString();
        try { localStorage.setItem('fb_ctx', JSON.stringify(FEEDBACK)); } catch {}
      });
    });
  </script>
</body>
</html>
