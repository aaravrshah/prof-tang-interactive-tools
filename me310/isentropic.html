<!-- /me310/isentropic.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Isentropic Relations (Ideal Gas)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../styles.css" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // keep MathJax sizing consistent with other pages
    window.MathJax = { chtml:{ scale:0.9 }, options:{ renderActions:{ addMenu:[] } } };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1>Isentropic Relations (Ideal Gas)</h1>
      <p class="subtitle">
        Goal: make the <b>equations</b> and their meanings obvious, then explore how the ratios change with Mach number \(M\)
        and heat-capacity ratio \( \gamma \).
      </p>
    </div>
  </header>

  <main class="container">
    <!-- unified back button placement -->
    <nav class="back-row">
      <a href="../index.html" class="back-home" aria-label="Back to home">
        <span class="chev">←</span> Home
      </a>
    </nav>

    <!-- EQUATIONS & NAMES (TOP) -->
    <section class="card">
      <div class="eqwrap">
        <div class="note" style="margin-bottom:8px"><b>Isentropic (ideal-gas) ratios</b></div>
        <div class="eqbig">
          \( \displaystyle \frac{T}{T_0}=\Big(1+\frac{\gamma-1}{2}M^2\Big)^{-1}, \quad
             \frac{p}{p_0}=\Big(1+\frac{\gamma-1}{2}M^2\Big)^{-\gamma/(\gamma-1)}, \quad
             \frac{\rho}{\rho_0}=\Big(1+\frac{\gamma-1}{2}M^2\Big)^{-1/(\gamma-1)}. \)
        </div>
        <div class="note">
          <b>Names (what symbols mean)</b>
          <ul style="margin:8px 0 0 20px">
            <li><b>M</b> — Mach number (flow speed / local speed of sound)</li>
            <li><b>γ</b> — ratio of specific heats (Cp/Cv); ≈ 1.40 for air (diatomic), 1.67 monatomic, 1.30 CO₂</li>
            <li><b>T</b>, <b>p</b>, <b>ρ</b> — local <i>static</i> temperature, pressure, density</li>
            <li><b>T₀</b>, <b>p₀</b>, <b>ρ₀</b> — <i>stagnation (total)</i> values (flow brought to rest isentropically)</li>
          </ul>
          <div style="margin-top:8px">
            <span class="badge">Rule of thumb:</span> Bernoulli (incompressible) is typically OK when \( M \lesssim 0.28 \) (≈ 2% pressure error).
          </div>
        </div>
      </div>
    </section>

    <!-- MAIN PLOT -->
    <section class="card">
      <div class="controls">
        <div class="ctl">
          <label>M: <span id="machLabel" class="kbd">1.00</span></label>
          <input id="mach" type="range" min="0.10" max="5.00" step="0.01" value="1.00" />
        </div>
        <div class="ctl">
          <label>γ (heat-capacity ratio)</label>
          <select id="gamma">
            <option value="1.40" selected>1.40 — Air (diatomic N₂/O₂)</option>
            <option value="1.67">1.67 — Monatomic (He/Ar/Ne)</option>
            <option value="1.30">1.30 — CO₂ (polyatomic)</option>
          </select>
        </div>
        <div class="ctl">
          <label>Status</label>
          <span id="bernFlag" class="badge" style="display:inline-block;min-width:260px;text-align:center">—</span>
        </div>
      </div>

      <div class="legend" style="margin-top:4px">
        <span class="sw" style="background:#ef4444"></span> T/T₀
        <span class="sw" style="background:#22c55e"></span> p/p₀
        <span class="sw" style="background:#3b82f6"></span> ρ/ρ₀
      </div>

      <div id="plot" class="viz" style="margin-top:6px"></div>
      <div class="note" style="margin-top:10px">
        <b>Tip:</b> Drag anywhere across the plot to change \(M\). Curves show <i>static</i> to <i>stagnation</i> ratios for the chosen \( \gamma \).
      </div>
      <div id="readout" class="note" style="margin-top:8px"></div>
    </section>
  </main>

  <script>
    /* ===== math ===== */
    function isoRatios(M, g){
      const TT0 = 1/(1 + ((g-1)/2)*M*M);
      return { T_T0:TT0, p_p0:Math.pow(TT0, g/(g-1)), r_r0:Math.pow(TT0, 1/(g-1)) };
    }

    /* ===== main plot ===== */
    let gamma = 1.40, Mmark = 1.00;

    const plotEl = document.getElementById('plot');
    function size(){ const w = plotEl.clientWidth || 760; return {w:Math.max(620,w), h:420, m:56}; }

    function drawMain(){
      const {w,h,m} = size();
      d3.select('#plot').html('');
      const svg = d3.select('#plot').append('svg').attr('viewBox',`0 0 ${w} ${h}`);

      const Mmin=0.10, Mmax=5.0;
      const x = d3.scaleLinear().domain([Mmin,Mmax]).range([m, w-m]);
      const yL = d3.scaleLinear().domain([0,1.1]).range([h-m, m]);

      // axes
      svg.append('g').attr('transform',`translate(${m},0)`).call(d3.axisLeft(yL).ticks(8));
      svg.append('g').attr('transform',`translate(0,${h-m})`).call(d3.axisBottom(x).ticks(8));
      svg.append('text').attr('x', w/2).attr('y', h-12).attr('text-anchor','middle').text('Mach number, M');
      svg.append('text').attr('x', -(h/2)).attr('y', 18).attr('text-anchor','middle').attr('transform','rotate(-90)').text('T/T₀, p/p₀, ρ/ρ₀');

      // curves
      const Ms = d3.range(Mmin, Mmax+0.005, 0.005).map(mm=>({M:mm, ...isoRatios(mm,gamma)}));
      const L = key => d3.line().x(d=>x(d.M)).y(d=>yL(d[key]))(Ms);
      svg.append('path').attr('d', L('T_T0')).attr('stroke','#ef4444').attr('stroke-width',2).attr('fill','none');
      svg.append('path').attr('d', L('p_p0')).attr('stroke','#22c55e').attr('stroke-width',2).attr('fill','none');
      svg.append('path').attr('d', L('r_r0')).attr('stroke','#3b82f6').attr('stroke-width',2).attr('fill','none');

      // drag anywhere
      const dragTo = (ev)=>{ const xm = Math.max(m, Math.min(w-m, ev.x)); setM(x.invert(xm)); };
      const line = svg.append('line')
        .attr('x1', x(Mmark)).attr('x2', x(Mmark)).attr('y1', m).attr('y2', h-m+44)
        .attr('stroke','#111').attr('stroke-width',2).attr('stroke-dasharray','5 3')
        .style('cursor','ew-resize')
        .call(d3.drag().on('drag', dragTo));
      const knob = svg.append('circle')
        .attr('cx', x(Mmark)).attr('cy', h-m+44).attr('r', 10)
        .attr('fill', '#0ea5e9').attr('stroke','#111')
        .style('cursor','ew-resize')
        .call(d3.drag().on('drag', dragTo));
      svg.append('rect').attr('x',m).attr('y',m).attr('width',w-2*m).attr('height',h-2*m)
         .attr('fill','transparent').style('cursor','ew-resize')
         .call(d3.drag().on('drag', dragTo));

      function refresh(){ line.attr('x1',x(Mmark)).attr('x2',x(Mmark)); knob.attr('cx',x(Mmark)); }
      updateReadout(); updateBernFlag();
      return { refresh };
    }

    function updateReadout(){
      const s = isoRatios(Mmark, gamma);
      const txt = [
        `<b>M</b> = ${Mmark.toFixed(2)}`,
        `<b>γ</b> = ${gamma.toFixed(2)}`,
        `<b>T/T₀</b> = ${s.T_T0.toFixed(3)}`,
        `<b>p/p₀</b> = ${s.p_p0.toFixed(3)}`,
        `<b>ρ/ρ₀</b> = ${s.r_r0.toFixed(3)}`
      ].join(' • ');
      document.getElementById('readout').innerHTML = txt;
    }

    function updateBernFlag(){
      const el = document.getElementById('bernFlag');
      if (Mmark <= 0.28){
        el.textContent = 'Status: Incompressible OK (≈≤2% p error)';
        el.style.borderColor = '#d1fae5'; el.style.background = '#ecfdf5'; el.style.color = '#065f46';
      } else {
        el.textContent = 'Status: Compressibility important';
        el.style.borderColor = '#fee2e2'; el.style.background = '#fef2f2'; el.style.color = '#7f1d1d';
      }
    }

    let mainAPI = drawMain();

    function setM(val){
      Mmark = Math.max(0.10, Math.min(5.0, val));
      document.getElementById('mach').value = Mmark.toFixed(2);
      document.getElementById('machLabel').textContent = Mmark.toFixed(2);
      mainAPI.refresh(); updateReadout(); updateBernFlag();
    }

    document.getElementById('mach').addEventListener('input', e => setM(parseFloat(e.target.value)));
    document.getElementById('gamma').addEventListener('change', e => { gamma = parseFloat(e.target.value); mainAPI = drawMain(); });
    window.addEventListener('resize', ()=> { mainAPI = drawMain(); });
  </script>
</body>
</html>
