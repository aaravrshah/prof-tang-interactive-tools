<!-- /me310/3.10.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Siphon and Cavitation, Energy Line and Hydraulic Grade Line</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../styles.css" />
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <!-- MathJax -->
  <script>
    window.MathJax = { chtml:{scale:0.92}, options:{renderActions:{addMenu:[]}} };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    :root{ --Y_TITLE_PAD: 15px; --plot-min-h: 360px; }

    .ctl{background:#fff;border:1px solid var(--line);border-radius:var(--r-sm);padding:10px 12px}
    .eqwrap{padding:12px;border:1px dashed var(--line);border-radius:12px;background:#fcfcff}

    /* ===== TOP: left content + right sticky schematic ===== */
    .top-grid{display:grid;gap:12px;align-items:start}
    @media(min-width:980px){ .top-grid{ grid-template-columns: 1.25fr 0.75fr; } }
    .stack{display:grid;gap:12px}

    .sticky-schem{position: sticky; top: 12px; align-self:start;}
    .schem-box{
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      padding:10px;
    }
    .schem-ph{
      height: 340px;
      display:grid;
      place-items:center;
      border:2px dashed var(--line);
      border-radius:12px;
      background:#fafcff;
      color:#64748b;
      text-align:center;
      padding:12px;
    }
    .schem-ph .t{font-weight:800;color:#334155;margin-bottom:6px}
    .schem-cap{margin:8px 2px 0;font-size:13px;color:#64748b;line-height:1.35}

    /* ===== BOTTOM: inputs + plots ===== */
    .io-grid{display:grid;gap:12px;align-items:stretch;margin-top:12px}
    @media(min-width:1024px){ .io-grid{ grid-template-columns: 0.95fr 1.55fr; } }

    .inputs-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .ctl>label{display:block;font-size:13px;color:#4b5563;margin-bottom:6px}
    .pair{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .pair input[type="number"]{
      width:100%;
      padding:6px 8px;
      border:1px solid var(--line);
      border-radius:8px;
      background:#fff;
    }
    .pair input[type="range"]{width:100%}

    .kpis{
      display:grid;
      gap:10px;
      margin-top:10px;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    }
    .kpi{
      background:#fcfcff;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
    }
    .kpi .lab{font-size:12px;color:#6b7280}
    .kpi .val{font-size:16px;font-weight:700;color:#111;margin-top:2px}

    .plot-wrap{display:flex;flex-direction:column;height:100%}
    .viz{background:#fff;border:1px solid var(--line);border-radius:12px;padding:8px}
    .plot-wrap .viz{
      flex:1 1 auto;
      display:flex;
      padding:14px;
      border-radius:14px;
    }
    .plot-wrap .viz svg{width:100%;display:block}

    .plot-stack{display:grid;gap:14px}
    .plot-card-title{margin:6px 0 10px}

    .axis text{font-size:14px;fill:#111}
    .axis-title{font-size:16px;fill:#111}
    svg text{paint-order:stroke;stroke:#fff;stroke-width:3px;stroke-linejoin:round}
    .curve{stroke:#111;fill:none;stroke-width:2}
    .curve2{stroke:#111;fill:none;stroke-width:2;stroke-dasharray:8 6}
    .pt{fill:var(--danger);stroke:#111;stroke-width:1.2}
    .bar{stroke:#111;stroke-width:1}
    .gridline{stroke:#0001}
    .zeroline{stroke:#000;stroke-opacity:.18;stroke-dasharray:6 6}
    .lbl{font-size:14px;fill:#111;stroke:none}
    .mini-note{font-size:13px;color:#64748b;line-height:1.35;margin:8px 2px 0}
  </style>
</head>

<body>
<header class="site-header">
  <div class="container">
    <div class="header-row">
      <h1 style="margin:0">Siphon and Cavitation, Energy Line and Hydraulic Grade Line</h1>
      <a class="btn primary feedback-link" href="../feedback.html" target="_blank" rel="noopener">Send feedback</a>
    </div>
  </div>
</header>

<main class="container">
  <nav class="back-row">
    <a href="../index.html" class="back-home" aria-label="Back to home"><span class="chev">←</span> Home</a>
  </nav>

  <!-- ===== TOP SECTION ===== -->
  <section class="top-grid">
    <!-- LEFT: Problem + Solution -->
    <div class="stack">
      <section class="card ps">
        <h3 style="margin:6px 0 10px">Problem Statement</h3>
        <div class="eqwrap">
          <h4 style="margin:0 0 6px">Given</h4>
          <ul style="margin:6px 0 10px 20px">
            <li>A liquid can be siphoned from a container, as shown in the schematic.</li>
            <li>Point (3), the end of the tube, is below the free surface in the container, point (1).</li>
            <li>The maximum elevation of the tube, point (2), is “not too great.”</li>
            <li>Consider water at 60&nbsp;°F being siphoned from a large tank through a constant-diameter hose.</li>
            <li>The end of the siphon is 5&nbsp;ft below the bottom of the tank, and atmospheric pressure is 14.7&nbsp;psia.</li>
          </ul>

          <h4 style="margin:0 0 6px">Find</h4>
          <p style="margin:0">Determine the maximum height of the hill, \(H\), over which the water can be siphoned without cavitation occurring.</p>
        </div>
      </section>

      <section class="card analysis-card">
        <h3 style="margin:6px 0 8px">Solution</h3>

        <div class="eqwrap" style="margin-top:8px">
          <p style="margin:0 0 6px"><b>If the flow is steady, inviscid, and incompressible, we can apply the Bernoulli equation along the streamline from (1) to (2) to (3) as follows:</b></p>
          \[
            p_1+\frac12\rho V_1^2+\gamma z_1
            =p_2+\frac12\rho V_2^2+\gamma z_2
            =p_3+\frac12\rho V_3^2+\gamma z_3 \qquad (1)
          \]
        </div>

        <div class="eqwrap" style="margin-top:10px">
          <p style="margin:0 0 6px">
            With the tank bottom as the datum, we have \(z_1=15~\text{ft}\), \(z_2=H\), and \(z_3=-5~\text{ft}\).
            Also, \(V_1=0\) (large tank), \(p_1=0\) (open tank), \(p_3=0\) (free jet), and from the continuity equation \(A_2V_2=A_3V_3\),
            or because the hose is constant diameter, \(V_2=V_3\). The speed of the fluid in the hose is determined from Eq. (1) to be
          </p>
          \[
            V_3=\sqrt{2g(z_1-z_3)}
          \]
        </div>

        <div class="eqwrap" style="margin-top:10px">
          <p style="margin:0 0 6px"><b>Use of Eq. (1) between points (1) and (2) then gives the pressure \(p_2\) at the top of the hill as</b></p>
          \[
            p_2
            =p_1+\frac12\rho V_1^2+\gamma z_1-\frac12\rho V_2^2-\gamma z_2
            =\gamma(z_1-z_2)-\frac12\rho V_2^2 \qquad (2)
          \]
        </div>

        <div class="eqwrap" style="margin-top:10px">
          <p style="margin:0 0 6px">
            From Table B.1, the vapor pressure of water at 60&nbsp;°F is \(0.256~\text{psia}\).
            Hence, for incipient cavitation the lowest pressure in the system will be \(p_2=0.256~\text{psia}\).
            Since we have used gage pressure at point (1) (\(p_1=0\)), we must use gage pressure at point (2) also.
            Thus \(p_2=0.256-14.7=-14.4~\text{psi}\), and Eq. (2) gives \(H\).
          </p>
        </div>

        <div class="eqwrap" style="margin-top:10px">
          <p style="margin:0 0 6px"><b>Answer</b></p>
          \[
            H = 28.2~\text{ft}
          \]
          <p style="margin:10px 0 0"><b>Comment:</b> For larger values of \(H\), vapor bubbles will form at point (2) and the siphon action may stop.</p>
        </div>
      </section>
    </div>

    <!-- RIGHT: Sticky schematic placeholder -->
    <aside class="sticky-schem" aria-label="Schematic">
      <div class="card">
        <h3 style="margin:6px 0 10px">Schematic</h3>
        <div class="schem-box">
          <div class="schem-ph">
            <div>
              <div class="t">Schematic placeholder</div>
              <div>
                Tank free surface (1), hill crest (2) at height \(H\), outlet (3) below tank bottom.
                Constant-diameter siphon hose.
              </div>
            </div>
          </div>
          <div class="schem-cap">Add your schematic image later (e.g., <code>../assets/thumbs/3.10.png</code>).</div>
        </div>
      </div>
    </aside>
  </section>

  <!-- ===== BOTTOM SECTION ===== -->
  <section class="io-grid" id="io">
    <!-- Inputs & Outputs -->
    <section class="card">
      <h3 style="margin:6px 0 10px">Inputs &amp; Outputs</h3>

      <div class="inputs-grid">
        <div class="ctl">
          <label>Free-surface elevation, \(z_1\) (ft)</label>
          <div class="pair">
            <input id="z1" type="number" step="0.1" value="15.0">
            <input id="z1_s" type="range" step="0.1">
          </div>
        </div>

        <div class="ctl">
          <label>Outlet elevation, \(z_3\) (ft)</label>
          <div class="pair">
            <input id="z3" type="number" step="0.1" value="-5.0">
            <input id="z3_s" type="range" step="0.1">
          </div>
        </div>

        <div class="ctl">
          <label>Atmospheric pressure, \(p_{\text{atm}}\) (psia)</label>
          <div class="pair">
            <input id="patm" type="number" step="0.1" value="14.7">
            <input id="patm_s" type="range" step="0.1">
          </div>
        </div>

        <div class="ctl">
          <label>Vapor pressure at temperature, \(p_v\) (psia)</label>
          <div class="pair">
            <input id="pv" type="number" step="0.001" value="0.256">
            <input id="pv_s" type="range" step="0.001">
          </div>
        </div>

        <div class="ctl">
          <label>Fluid specific weight, \(\gamma\) (lbf/ft\(^3\))</label>
          <div class="pair">
            <input id="gamma" type="number" step="0.1" value="62.4">
            <input id="gamma_s" type="range" step="0.1">
          </div>
        </div>

        <div class="ctl" style="grid-column:1 / -1">
          <label>Hill elevation, \(H=z_2\) (ft)</label>
          <div class="pair" style="grid-template-columns:260px 1fr">
            <input id="H" type="number" step="0.1" value="28.2">
            <input id="H_s" type="range" step="0.1">
          </div>
        </div>
      </div>

      <div class="kpis">
        <div class="kpi">
          <div class="lab">H\(_\text{max}\) at incipient cavitation (ft)</div>
          <div class="val" id="Hmax">—</div>
        </div>
        <div class="kpi">
          <div class="lab">Hose speed, \(V_2=V_3\) (ft/s)</div>
          <div class="val" id="V">—</div>
        </div>
        <div class="kpi">
          <div class="lab">Pressure at crest, \(p_2\) (psig)</div>
          <div class="val" id="p2g">—</div>
        </div>
      </div>

      <p class="mini-note">
        Assumptions used for the plots: steady, inviscid, incompressible; \(V_1\approx 0\), \(p_1=0\) (gage), \(p_3=0\) (free jet),
        constant-diameter hose so \(V_2=V_3\).
      </p>
    </section>

    <!-- Plots -->
    <section class="card plot-wrap" id="plot-card">
      <h3 class="plot-card-title">Plots</h3>

      <div class="plot-stack">
        <div class="viz">
          <svg id="plotELHGL" viewBox="0 0 760 360" aria-label="Energy line and hydraulic grade line"></svg>
        </div>
        <div class="mini-note">
          Energy line (EGL): \(z+\dfrac{p}{\gamma}+\dfrac{V^2}{2g}\). Hydraulic grade line (HGL): \(z+\dfrac{p}{\gamma}\).
        </div>

        <div class="viz">
          <svg id="plotBars" viewBox="0 0 760 300" aria-label="Maximum siphon height by fluid"></svg>
        </div>
        <div class="mini-note">
          Fluid comparison (illustrative): bars approximate the example’s figure showing how \(H\) changes with fluid properties.
        </div>
      </div>
    </section>
  </section>
</main>

<footer class="site-footer">
  <div class="container">
    <a href="../index.html" class="back-home"><span class="chev">←</span> Home</a>
  </div>
</footer>

<script>
  const $ = id => document.getElementById(id);
  const clamp = (v, lo, hi) => Math.min(hi, Math.max(lo, v));
  const fmt = (x, d=2) => (Number.isFinite(x) ? (+x).toFixed(d) : "—");

  // constants (US customary)
  const g = 32.2;                 // ft/s^2
  const FT2_PER_PSI = 144;        // (lbf/ft^2) per psi
  const PSI_PER_FT2 = 1/144;

  // internal ranges (not shown)
  const R = {
    z1:    {min: 0,   max: 30,   step:0.1},
    z3:    {min:-20,  max: 10,   step:0.1},
    patm:  {min:10,   max: 16,   step:0.1},
    pv:    {min:0.05, max: 3.00, step:0.001},
    gamma: {min:40,   max: 70,   step:0.1},
    H:     {min: 0,   max: 45,   step:0.1}
  };

  const state = {
    z1: 15.0,
    z3: -5.0,
    patm: 14.7,
    pv: 0.256,
    gamma: 62.4,
    H: 28.2
  };

  function setRanges(){
    for(const k of ["z1","z3","patm","pv","gamma","H"]){
      const n = $(k), s = $(k+"_s");
      n.min = R[k].min; n.max = R[k].max; n.step = R[k].step;
      s.min = R[k].min; s.max = R[k].max; s.step = R[k].step;
    }
  }

  function syncUIFromState(){
    $("z1").value = state.z1; $("z1_s").value = state.z1;
    $("z3").value = state.z3; $("z3_s").value = state.z3;
    $("patm").value = state.patm; $("patm_s").value = state.patm;
    $("pv").value = state.pv; $("pv_s").value = state.pv;
    $("gamma").value = state.gamma; $("gamma_s").value = state.gamma;
    $("H").value = state.H; $("H_s").value = state.H;
  }

  function readStateFromUI(){
    state.z1    = clamp(+($("z1").value||0), R.z1.min, R.z1.max);
    state.z3    = clamp(+($("z3").value||0), R.z3.min, R.z3.max);
    state.patm  = clamp(+($("patm").value||14.7), R.patm.min, R.patm.max);
    state.pv    = clamp(+($("pv").value||0.256), R.pv.min, R.pv.max);
    state.gamma = clamp(+($("gamma").value||62.4), R.gamma.min, R.gamma.max);
    state.H     = clamp(+($("H").value||0), R.H.min, R.H.max);
    syncUIFromState();
  }

  // V from Eq (1) using (1) to (3): V = sqrt(2 g (z1 - z3))
  function V_hose(){
    const dz = state.z1 - state.z3;
    if(!(dz >= 0)) return NaN;
    return Math.sqrt(2*g*dz);
  }

  // p2 (psig) from Eq (2): p2 = gamma(z1 - H) - (1/2) rho V^2, but use gamma & rho relation: rho = gamma/g
  // => (1/2) rho V^2 = (gamma/g) * (V^2/2) = gamma * V^2/(2g)
  // p2 (lbf/ft^2) = gamma(z1 - H) - gamma*V^2/(2g)
  function p2_gauge_psig(H){
    const V = V_hose();
    if(!Number.isFinite(V)) return NaN;
    const p2_ft2 = state.gamma*(state.z1 - H) - state.gamma*(V*V)/(2*g);
    return p2_ft2 * PSI_PER_FT2;
  }

  // Hmax when p2_abs = pv  => p2_gage = pv - patm  (psi)
  // Use p2_gage( Hmax ) = pv - patm  solve:
  // (gamma(z1 - Hmax) - gamma V^2/(2g)) /144 = pv - patm
  // => gamma(z1 - Hmax) - gamma V^2/(2g) = 144(pv - patm)
  // => Hmax = z1 - [144(pv - patm) + gamma V^2/(2g)]/gamma
  function H_max(){
    const V = V_hose();
    if(!Number.isFinite(V)) return NaN;
    const p2g_required_psi = state.pv - state.patm;
    const rhs_ft2 = FT2_PER_PSI * p2g_required_psi; // lbf/ft^2
    const velTerm = state.gamma*(V*V)/(2*g);         // lbf/ft^2
    const Hmax = state.z1 - (rhs_ft2 + velTerm)/state.gamma;
    return Hmax;
  }

  function updateOutputs(){
    const V = V_hose();
    const Hmax = H_max();
    const p2g = p2_gauge_psig(state.H);

    $("V").textContent    = Number.isFinite(V) ? `${fmt(V,1)} ft/s` : "—";
    $("Hmax").textContent = Number.isFinite(Hmax) ? `${fmt(Hmax,1)} ft` : "—";
    $("p2g").textContent  = Number.isFinite(p2g) ? `${fmt(p2g,2)} psig` : "—";
  }

  // ===== Plot 1: EGL & HGL =====
  const svg1 = d3.select("#plotELHGL");
  const W1 = 760, H1 = 360;
  const M1 = {l: 76, r: 22, t: 18, b: 58};
  const PW1 = W1 - M1.l - M1.r;
  const PH1 = H1 - M1.t - M1.b;

  const gPlot1 = svg1.append("g").attr("transform", `translate(${M1.l},${M1.t})`);
  gPlot1.append("rect").attr("x",0).attr("y",0).attr("width",PW1).attr("height",PH1).attr("fill","#fff");

  const x1 = d3.scaleLinear().domain([0,2]).range([0,PW1]); // 0:(1), 1:(2), 2:(3)

  const ax1 = gPlot1.append("g").attr("class","axis").attr("transform",`translate(0,${PH1})`);
  const ay1 = gPlot1.append("g").attr("class","axis");

  // x tick labels as points
  function drawAxes1(yDomain){
    const y1 = d3.scaleLinear().domain(yDomain).range([PH1,0]);
    ax1.call(d3.axisBottom(x1).tickValues([0,1,2]).tickFormat(d => d===0?"(1)":d===1?"(2)":"(3)"));
    ay1.call(d3.axisLeft(y1).ticks(6));

    // titles
    svg1.selectAll(".axis-title").remove();

    gPlot1.append("text")
      .attr("class","axis-title")
      .attr("x", PW1/2).attr("y", PH1 + 46)
      .attr("text-anchor","middle")
      .text("Point along siphon");

    gPlot1.append("text")
      .attr("class","axis-title")
      .attr("transform","rotate(-90)")
      .attr("x", -PH1/2)
      .attr("y", -(15 + 48))
      .attr("text-anchor","middle")
      .text("Head (ft)");

    // gridlines
    gPlot1.selectAll(".gridline").remove();
    y1.ticks(10).forEach(t=>{
      gPlot1.append("line")
        .attr("class","gridline")
        .attr("x1",0).attr("x2",PW1)
        .attr("y1",y1(t)).attr("y2",y1(t));
    });

    return y1;
  }

  const pathEGL = gPlot1.append("path").attr("class","curve");
  const pathHGL = gPlot1.append("path").attr("class","curve2");
  const ptsG = gPlot1.append("g");
  const lblG = gPlot1.append("g");

  function computeLines(){
    const V = V_hose();
    if(!Number.isFinite(V)) return null;

    // p1=0 (gage), V1≈0
    const z1 = state.z1;
    const z2 = state.H;
    const z3 = state.z3;

    const p1g = 0;                 // psig
    const p3g = 0;                 // psig
    const p2g = p2_gauge_psig(state.H);

    const pHead1 = (p1g*FT2_PER_PSI)/state.gamma; // ft
    const pHead2 = (p2g*FT2_PER_PSI)/state.gamma; // ft
    const pHead3 = (p3g*FT2_PER_PSI)/state.gamma; // ft

    const vHead = (V*V)/(2*g);     // ft

    // HGL = z + p/gamma
    const HGL = [
      {s:0, h: z1 + pHead1},
      {s:1, h: z2 + pHead2},
      {s:2, h: z3 + pHead3}
    ];

    // EGL = HGL + V^2/(2g) (at 2 and 3); at 1 V≈0
    const EGL = [
      {s:0, h: z1 + pHead1 + 0},
      {s:1, h: z2 + pHead2 + vHead},
      {s:2, h: z3 + pHead3 + vHead}
    ];

    return {HGL, EGL, vHead, p2g};
  }

  function renderELHGL(){
    const out = computeLines();
    if(!out){
      pathEGL.attr("d","");
      pathHGL.attr("d","");
      ptsG.selectAll("*").remove();
      lblG.selectAll("*").remove();
      return;
    }

    const allY = [...out.HGL.map(d=>d.h), ...out.EGL.map(d=>d.h)];
    const yMin = Math.min(...allY) - 5;
    const yMax = Math.max(...allY) + 5;
    const y1 = drawAxes1([yMin, yMax]);

    const L = d3.line().x(d=>x1(d.s)).y(d=>y1(d.h));
    pathEGL.attr("d", L(out.EGL));
    pathHGL.attr("d", L(out.HGL));

    // points
    ptsG.selectAll("*").remove();
    ptsG.selectAll("circle.pt1")
      .data(out.EGL)
      .enter().append("circle")
      .attr("class","pt")
      .attr("r",5.5)
      .attr("cx",d=>x1(d.s))
      .attr("cy",d=>y1(d.h));

    ptsG.selectAll("circle.pt2")
      .data(out.HGL)
      .enter().append("circle")
      .attr("class","pt")
      .attr("r",5.5)
      .attr("cx",d=>x1(d.s))
      .attr("cy",d=>y1(d.h));

    // labels
    lblG.selectAll("*").remove();
    lblG.append("text")
      .attr("x", x1(1.55))
      .attr("y", y1(out.EGL[2].h) - 10)
      .attr("class","lbl")
      .text("EGL");

    lblG.append("text")
      .attr("x", x1(1.55))
      .attr("y", y1(out.HGL[2].h) + 18)
      .attr("class","lbl")
      .text("HGL");
  }

  // ===== Plot 2: bar chart (illustrative from the provided figure) =====
  const svg2 = d3.select("#plotBars");
  const W2 = 760, H2 = 300;
  const M2 = {l: 76, r: 22, t: 18, b: 58};
  const PW2 = W2 - M2.l - M2.r;
  const PH2 = H2 - M2.t - M2.b;
  const gPlot2 = svg2.append("g").attr("transform", `translate(${M2.l},${M2.t})`);
  gPlot2.append("rect").attr("x",0).attr("y",0).attr("width",PW2).attr("height",PH2).attr("fill","#fff");

  // approximate bar heights from the provided chart
  const fluids = [
    {name:"Alcohol", H:35.0},
    {name:"Water", H:28.2},
    {name:"Gasoline", H:18.0},
    {name:"Carbon tet", H:12.0}
  ];

  const x2 = d3.scaleBand().domain(fluids.map(d=>d.name)).range([0,PW2]).padding(0.25);
  const y2 = d3.scaleLinear().domain([0,40]).range([PH2,0]);

  gPlot2.append("g").attr("class","axis").attr("transform",`translate(0,${PH2})`).call(d3.axisBottom(x2));
  gPlot2.append("g").attr("class","axis").call(d3.axisLeft(y2).ticks(5));

  gPlot2.append("text")
    .attr("class","axis-title")
    .attr("x", PW2/2).attr("y", PH2 + 46)
    .attr("text-anchor","middle")
    .text("Fluid");

  gPlot2.append("text")
    .attr("class","axis-title")
    .attr("transform","rotate(-90)")
    .attr("x", -PH2/2)
    .attr("y", -(15 + 48))
    .attr("text-anchor","middle")
    .text("H (ft)");

  y2.ticks(10).forEach(t=>{
    gPlot2.append("line")
      .attr("class","gridline")
      .attr("x1",0).attr("x2",PW2)
      .attr("y1",y2(t)).attr("y2",y2(t));
  });

  gPlot2.selectAll("rect.bar")
    .data(fluids)
    .enter().append("rect")
    .attr("class","bar")
    .attr("x",d=>x2(d.name))
    .attr("y",d=>y2(d.H))
    .attr("width",x2.bandwidth())
    .attr("height",d=>PH2 - y2(d.H))
    .attr("fill","#9ca3af");

  // highlight water bar slightly darker
  gPlot2.selectAll("rect.bar-water")
    .data(fluids.filter(d=>d.name==="Water"))
    .enter().append("rect")
    .attr("class","bar")
    .attr("x",d=>x2(d.name))
    .attr("y",d=>y2(d.H))
    .attr("width",x2.bandwidth())
    .attr("height",d=>PH2 - y2(d.H))
    .attr("fill","#6b7280");

  function renderAll(){
    updateOutputs();
    renderELHGL();
  }

  function bindPair(numId, rangeId, key){
    const n = $(numId), s = $(rangeId);
    n.addEventListener("input", ()=>{ readStateFromUI(); renderAll(); });
    s.addEventListener("input", ()=>{ state[key] = +s.value; syncUIFromState(); renderAll(); });
  }

  // feedback context
  (function(){
    const FEEDBACK = { course: "ME 310", sim: "Siphon and Cavitation, Energy Line and Hydraulic Grade Line" };
    document.addEventListener("DOMContentLoaded", () => {
      const url = new URL("../feedback.html", location.href);
      url.searchParams.set("course", FEEDBACK.course);
      url.searchParams.set("sim", FEEDBACK.sim);
      document.querySelectorAll("a.feedback-link").forEach(a => {
        a.href = url.toString();
        try { localStorage.setItem("fb_ctx", JSON.stringify(FEEDBACK)); } catch {}
      });
    });
  })();

  // init
  setRanges();
  syncUIFromState();
  bindPair("z1","z1_s","z1");
  bindPair("z3","z3_s","z3");
  bindPair("patm","patm_s","patm");
  bindPair("pv","pv_s","pv");
  bindPair("gamma","gamma_s","gamma");
  bindPair("H","H_s","H");
  renderAll();
</script>
</body>
</html>